<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="js/jquery/jquery.js"></script>
        <script src="js/dom.jsPlumb-1.7.2-min.js"></script>
        <script src ="js/synthUI.js"></script>
        <script>
            var synthUI;
            var instrument;
            jsPlumb.ready(function() {
                jsPlumb.setContainer("plumbing");
                synthUI = new SynthUI($("#plumbing"));
                var instrumentInfo = synthUI.updateInstrumentInfo();
                instrument = new Instrument(instrumentInfo, new AudioContext());
                var instrumentIo = new Io($("#instrumentIODiv"), 
                    "instrument", 
                    function(){
                        synthUI.updateInstrumentInfo();
                        return JSON.stringify(instrumentInfo);
                    },
                    function(instrumentInfo){synthUI.loadSave(instrumentInfo)},
                    function(){synthUI.newInstrument()}
                )
            });
            $(function() {
                $("#zoom").on("input", function() {
                    var zoom = $(this).val();
                    $("#plumbing").css("transform", "scale(" + zoom + ")");
                    jsPlumb.setZoom(zoom);
                    //$(".plumbNode").css("border",(1.49/zoom)+"px solid black");
                });
                for(var i=48; i<73; i++){
                    makeButton(i);
                }
            })
            function makeButton(midi){
                $("<button>").text(midi).appendTo("#scale").on("click", function(){
                    var start = instrument.audioContext.currentTime + 0.25;
                    var stop = start + parseFloat($("#duration").val());
                    var freq = midiToFrequency(midi);
                    instrument.play(freq, start, stop, 1, true);
                })
            }
            function midiToFrequency(midi) {
                var aOffset = midi - 69;
                var a = 440;
                return a * Math.pow(2, aOffset / 12);
            }
        </script>
        <link rel="stylesheet" href="css/synthUI.css">            
    </head>
    <body>
        <div id="instrumentIODiv"></div>
        <button id="addCarrier">Add Carrier</button>
        <button id="addModulator">Add Modulator</button>
        <button id="addEnvelope">Add Envelope</button>
        <button id="addBeta">Add Beta</button>
        duration<input id="duration" value="1" data-hint="in seconds">
        <div id="scale"></div>
        <input id="zoom" type="range" min="0.25" max="1" step="0.25" value="1">
        <div id="plumbingOuter">
            <div id="plumbing">
            </div>
        </div>
    </body>
</html>
